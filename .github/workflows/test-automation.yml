# ===============================================
# à¹„à¸Ÿà¸¥à¹Œà¸™à¸µà¹‰à¸„à¸·à¸­à¸•à¸±à¸§à¸—à¸µà¹ˆà¸ˆà¸°à¸£à¸±à¸™à¹€à¸—à¸ªà¹ƒà¸«à¹‰à¹€à¸£à¸²à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´
# ===============================================

# à¸Šà¸·à¹ˆà¸­à¸—à¸µà¹ˆà¸ˆà¸°à¹à¸ªà¸”à¸‡à¹ƒà¸™ GitHub à¹€à¸¡à¸·à¹ˆà¸­à¸à¸”à¸›à¸¸à¹ˆà¸¡ Run à¸šà¸™ Githin
name: Web Test Auto Run

# à¸à¸³à¸«à¸™à¸”à¸§à¹ˆà¸²à¸ˆà¸°à¸£à¸±à¸™à¹€à¸¡à¸·à¹ˆà¸­à¹„à¸«à¸£à¹ˆ
on:
  # à¸£à¸±à¸™à¹€à¸¡à¸·à¹ˆà¸­ push code à¹„à¸›à¸—à¸µà¹ˆ branch main
  push:
    branches: [ main ]
  # à¸£à¸±à¸™à¹€à¸¡à¸·à¹ˆà¸­à¸à¸”à¸›à¸¸à¹ˆà¸¡à¸£à¸±à¸™à¹€à¸­à¸‡à¹ƒà¸™ GitHub
  workflow_dispatch:

# à¸‡à¸²à¸™à¸—à¸µà¹ˆà¸ˆà¸°à¸—à¸³
jobs:
  # à¸Šà¸·à¹ˆà¸­à¸‡à¸²à¸™: test-web
  test-web:
    # à¹ƒà¸Šà¹‰à¸„à¸­à¸¡à¸à¸´à¸§à¹€à¸•à¸­à¸£à¹Œ Ubuntu (Linux) à¸‚à¸­à¸‡ GitHub
    runs-on: ubuntu-latest
    
    # à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™à¸à¸²à¸£à¸—à¸³à¸‡à¸²à¸™
    steps:
      # ============================================
      # STEP 1: Setup Environment
      # ============================================
      # à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™à¸—à¸µà¹ˆ 1: à¸”à¸¶à¸‡ code à¸ˆà¸²à¸ GitHub
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4
      
      # à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™à¸—à¸µà¹ˆ 2: à¸•à¸´à¸”à¸•à¸±à¹‰à¸‡ Python
      - name: ğŸ Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.12.4'
      
      # à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™à¸—à¸µà¹ˆ 3: à¸•à¸´à¸”à¸•à¸±à¹‰à¸‡ Robot Framework
      - name: Install Robot Framework
        run: |
          pip install -r requirements.txt

      # ============================================
      # STEP 2: Run Tests
      # ============================================
      - name: ğŸ§ª Run Web Tests Only
        run: |
          mkdir -p results
          
          # à¸§à¸´à¸˜à¸µà¸—à¸µà¹ˆ 1: à¸£à¸±à¸™à¹€à¸‰à¸à¸²à¸°à¹‚à¸Ÿà¸¥à¹€à¸”à¸­à¸£à¹Œ Web
          robot \
            --variable BROWSER:headlesschrome \
            --outputdir results \
            --output output.xml \
            --log log.html \
            --report report.html \
            --name "Web Tests" \
            TestScript/Web/Staging/FlowLogin.robot || true
          
          # à¹à¸ªà¸”à¸‡à¸œà¸¥à¸—à¸±à¸™à¸—à¸µà¸«à¸¥à¸±à¸‡à¸£à¸±à¸™
          echo "================================"
          echo "Test execution completed with exit code: ${EXIT_CODE:-0}"
          echo "================================"
      
      # ============================================
      # STEP 3: Generate Test Report
      # ============================================
      - name: ğŸ“Š Generate Test Summary Report
        if: always()
        run: |
          # à¸ªà¸£à¹‰à¸²à¸‡ Python script à¸ªà¸³à¸«à¸£à¸±à¸šà¸§à¸´à¹€à¸„à¸£à¸²à¸°à¸«à¹Œà¸œà¸¥
          cat > analyze_results.py << 'PYTHON_SCRIPT'
          import xml.etree.ElementTree as ET
          import os
          import json
          
          def analyze_robot_results():
              xml_file = 'results/output.xml'
              
              if not os.path.exists(xml_file):
                  print("âŒ à¹„à¸¡à¹ˆà¸à¸šà¹„à¸Ÿà¸¥à¹Œà¸œà¸¥à¸à¸²à¸£à¸—à¸”à¸ªà¸­à¸š")
                  return
              
              try:
                  tree = ET.parse(xml_file)
                  root = tree.getroot()
                  
                  # à¸”à¸¶à¸‡à¸ªà¸–à¸´à¸•à¸´à¸«à¸¥à¸±à¸
                  stats = root.find('.//statistics/total/stat')
                  if stats is None:
                      print("âŒ à¹„à¸¡à¹ˆà¸à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸–à¸´à¸•à¸´à¹ƒà¸™à¹„à¸Ÿà¸¥à¹Œ")
                      return
                  
                  # à¸™à¸±à¸šà¸ˆà¸³à¸™à¸§à¸™ Pass/Fail/Skip
                  passed = int(stats.get('pass', 0))
                  failed = int(stats.get('fail', 0))
                  skipped = int(stats.get('skip', 0))
                  total = passed + failed + skipped
                  
                  # à¸„à¸³à¸™à¸§à¸“à¹€à¸›à¸­à¸£à¹Œà¹€à¸‹à¹‡à¸™à¸•à¹Œ
                  pass_percentage = (passed / total * 100) if total > 0 else 0
                  fail_percentage = (failed / total * 100) if total > 0 else 0
                  
                  # à¹à¸ªà¸”à¸‡à¸œà¸¥à¹ƒà¸™ Console
                  print("\n" + "="*60)
                  print("ğŸ“Š WEB TEST EXECUTION SUMMARY")
                  print("="*60)
                  print(f"âœ… PASSED:  {passed:3d} tests ({pass_percentage:6.2f}%)")
                  print(f"âŒ FAILED:  {failed:3d} tests ({fail_percentage:6.2f}%)")
                  if skipped > 0:
                      skip_percentage = (skipped / total * 100)
                      print(f"â­ï¸  SKIPPED: {skipped:3d} tests ({skip_percentage:6.2f}%)")
                  print("-"*60)
                  print(f"ğŸ“Š TOTAL:   {total:3d} tests (100.00%)")
                  print(f"ğŸ“ˆ PASS RATE: {pass_percentage:.2f}%")
                  print("="*60)
                  
                  # à¸ªà¸–à¸²à¸™à¸°à¹‚à¸”à¸¢à¸£à¸§à¸¡
                  if pass_percentage == 100:
                      print("\nğŸ‰ EXCELLENT! All tests passed!")
                      status_emoji = "ğŸ‰"
                      status_text = "Perfect"
                  elif pass_percentage >= 80:
                      print("\nâœ… GOOD! Most tests passed")
                      status_emoji = "âœ…"
                      status_text = "Good"
                  elif pass_percentage >= 60:
                      print("\nâš ï¸  WARNING! Several tests failed")
                      status_emoji = "âš ï¸"
                      status_text = "Warning"
                  else:
                      print("\nâŒ CRITICAL! Many tests failed")
                      status_emoji = "âŒ"
                      status_text = "Critical"
                  
                  # à¸£à¸²à¸¢à¸à¸²à¸£ Test à¸—à¸µà¹ˆà¸œà¹ˆà¸²à¸™
                  print("\n" + "="*60)
                  print("ğŸ“‹ TEST DETAILS")
                  print("="*60)

                  passed_tests = []
                  failed_tests = []
                  for test in root.iter('test'):
                      test_name = test.get('name', 'Unknown')
                      test_status = test.get('status', 'UNKNOWN')
                      if test_status == 'PASS':
                          passed_tests.append(test_name)
                      elif test_status == 'FAIL':
                          failed_tests.append(test_name)
                          msg = test.find('.//msg[@level="FAIL"]')
                          error_msg = msg.text if msg is not None and msg.text else "No error message"
                          failed_tests.append(f"  â””â”€ Error: {error_msg[:100]}")

                  print("Passed tests =", passed_tests)
                  print("Failed tests =", failed_tests)

                  # passed_tests = []
                  # failed_tests = []
                  # for test in root.findall('.//test'):
                  #     test_name = test.get('name', 'Unknown')
                  #     test_status = test.get('status', 'UNKNOWN')
                  #     if test_status == 'PASS':
                  #         passed_tests.append(test_name)
                  #     elif test_status == 'FAIL':
                  #         failed_tests.append(test_name)
                  #         msg = test.find('.//msg[@level="FAIL"]')
                  #         error_msg = msg.text if msg is not None and msg.text else "No error message"
                  #         failed_tests.append(f"  â””â”€ Error: {error_msg[:100]}")

                  # print("Passed tests =", passed_tests)
                  # print("Failed tests =", failed_tests)
                  
                  # passed_tests = []
                  # failed_tests = []
                  
                  # for test in root.findall('.//test'):
                  #     test_name = test.get('name', 'Unknown')
                  #     test_status = test.get('status', 'UNKNOWN')
                      
                  #     if test_status == 'PASS':
                  #         passed_tests.append(test_name)
                  #     elif test_status == 'FAIL':
                  #         failed_tests.append(test_name)
                  #         à¸«à¸² error message
                  #         msg = test.find('.//msg[@level="FAIL"]')
                  #         error_msg = msg.text if msg is not None and msg.text else "No error message"
                  #         failed_tests.append(f"  â””â”€ Error: {error_msg[:100]}")
                  
                  # à¹à¸ªà¸”à¸‡ Passed Tests
                  # if passed_tests:
                  #     print(f"\nâœ… PASSED TESTS ({len([t for t in passed_tests if not t.startswith('  ')])} tests):")
                  #     print("-"*40)
                  #     for test in passed_tests[:10]:  # à¹à¸ªà¸”à¸‡à¹à¸„à¹ˆ 10 à¸­à¸±à¸™à¹à¸£à¸
                  #         print(f"  âœ“ {test}")
                  #     if len(passed_tests) > 10:
                  #         print(f"  ... and {len(passed_tests)-10} more")
                  
                  # à¹à¸ªà¸”à¸‡ Failed Tests
                  # if failed_tests:
                  #     print(f"\nâŒ FAILED TESTS ({failed} tests):")
                  #     print("-"*40)
                  #     for test in failed_tests:
                  #         if test.startswith('  '):
                  #             print(test)
                  #         else:
                  #             print(f"  âœ— {test}")
                  
                  # à¸ªà¸£à¹‰à¸²à¸‡à¹„à¸Ÿà¸¥à¹Œ JSON à¸ªà¸³à¸«à¸£à¸±à¸š Badge
                  # badge_data = {
                  #     "passed": passed,
                  #     "failed": failed,
                  #     "skipped": skipped,
                  #     "total": total,
                  #     "pass_rate": round(pass_percentage, 2),
                  #     "status": status_text
                  # }
                  
                  # with open('results/test_summary.json', 'w') as f:
                  #     json.dump(badge_data, f, indent=2)
                  
                  # à¸ªà¸£à¹‰à¸²à¸‡ Markdown à¸ªà¸³à¸«à¸£à¸±à¸š GitHub Summary
                  with open('test_summary.md', 'w', encoding='utf-8') as f:
                      f.write(f"# {status_emoji} Web Test Results\n\n")
                      f.write("## ğŸ“Š Summary\n\n")
                      f.write("| Status | Count | Test Names | Percentage |\n")
                      f.write("|--------|-------|------------|------------|\n")
                      
                      passed_list = "<br>".join(passed_tests) if passed_tests else "-"
                      f.write(f"| âœ… **Passed** | **{passed}** | {passed_list} | **{pass_percentage:.2f}%** |\n")
                      
                      # à¸£à¸²à¸¢à¸Šà¸·à¹ˆà¸­ test à¸—à¸µà¹ˆà¹„à¸¡à¹ˆà¸œà¹ˆà¸²à¸™ + error
                      if failed > 0:
                          failed_pairs = []
                          for i in range(0, len(failed_tests), 2):
                              name = failed_tests[i]
                              if i + 1 < len(failed_tests):
                                  error = failed_tests[i + 1][10:]
                              else:
                                  error = ""
                              failed_pairs.append(f"{name} <br><span style='color:#b33'>â€¢ {error}</span>")
                          failed_list = "<br><br>".join(failed_pairs)
                          f.write(f"| âŒ **Failed** | **{failed}** | {failed_list} | **{fail_percentage:.2f}%** |\n")
                      
                      f.write(f"| ğŸ“Š **Total** | **{total}** | - | **100.00%** |\n\n")
                  
                  print("\nâœ… Summary files created successfully!")
                  
                  # Set output variables for GitHub Actions
                  print(f"::set-output name=total::{total}")
                  print(f"::set-output name=passed::{passed}")
                  print(f"::set-output name=failed::{failed}")
                  print(f"::set-output name=pass_rate::{pass_percentage:.2f}")
                  
              except Exception as e:
                  print(f"âŒ Error analyzing results: {str(e)}")
          
          if __name__ == "__main__":
              analyze_robot_results()
          PYTHON_SCRIPT
          
          # à¸£à¸±à¸™ script à¸§à¸´à¹€à¸„à¸£à¸²à¸°à¸«à¹Œà¸œà¸¥
          python analyze_results.py

      - name: ğŸ“ Update GitHub Job Summary
        if: always()
        run: |
          # à¹€à¸à¸´à¹ˆà¸¡ Summary à¹ƒà¸™ GitHub
          if [ -f "test_summary.md" ]; then
            cat test_summary.md >> $GITHUB_STEP_SUMMARY
            
            # à¹€à¸à¸´à¹ˆà¸¡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹€à¸à¸´à¹ˆà¸¡à¹€à¸•à¸´à¸¡
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "---" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "### ğŸ“Œ Test Information" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "- **Branch:** ${{ github.ref_name }}" >> $GITHUB_STEP_SUMMARY
            echo "- **Runner:** ${{ runner.os }}" >> $GITHUB_STEP_SUMMARY
            echo "- **Triggered by:** @${{ github.actor }}" >> $GITHUB_STEP_SUMMARY
            echo "- **Workflow:** ${{ github.workflow }}" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
          else
            echo "âš ï¸ No test summary available" >> $GITHUB_STEP_SUMMARY
          fi
      
      - name: ğŸ“ Upload Test Results
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: test-results-${{ github.run_number }}
          path: results/
          retention-days: 30

      # - name: ğŸ“ Update GitHub Job Summary
      #   if: always()
      #   run: |
      #     # à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸§à¹ˆà¸²à¸¡à¸µà¹„à¸Ÿà¸¥à¹Œà¸œà¸¥à¸¥à¸±à¸à¸˜à¹Œà¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ
      #     if [ ! -f "results/output.xml" ]; then
      #       echo "# âŒ No Test Results Found" >> $GITHUB_STEP_SUMMARY
      #       echo "" >> $GITHUB_STEP_SUMMARY
      #       echo "**âš ï¸ à¹„à¸¡à¹ˆà¸à¸šà¹„à¸Ÿà¸¥à¹Œà¸œà¸¥à¸à¸²à¸£à¸—à¸”à¸ªà¸­à¸š**" >> $GITHUB_STEP_SUMMARY
      #       echo "" >> $GITHUB_STEP_SUMMARY
      #       echo "à¸à¸£à¸¸à¸“à¸²à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š:" >> $GITHUB_STEP_SUMMARY
      #       echo "- à¸¡à¸µà¹„à¸Ÿà¸¥à¹Œ test à¹ƒà¸™ TestScript/Web/ à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ" >> $GITHUB_STEP_SUMMARY
      #       echo "- Robot Framework à¸—à¸³à¸‡à¸²à¸™à¸–à¸¹à¸à¸•à¹‰à¸­à¸‡à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ" >> $GITHUB_STEP_SUMMARY
      #       exit 0
      #     fi
          
      #     # à¸§à¸´à¹€à¸„à¸£à¸²à¸°à¸«à¹Œà¸œà¸¥à¹à¸¥à¸°à¸ªà¸£à¹‰à¸²à¸‡ Summary
      #     python3 << 'PYTHON_EOF'
      #     import xml.etree.ElementTree as ET
      #     import os
          
      #     def create_summary():
      #         try:
      #             # à¸­à¹ˆà¸²à¸™ XML
      #             tree = ET.parse('results/output.xml')
      #             root = tree.getroot()
                  
      #             # à¸”à¸¶à¸‡à¸ªà¸–à¸´à¸•à¸´
      #             stats = root.find('.//statistics/total/stat')
      #             if not stats:
      #                 print("âŒ à¹„à¸¡à¹ˆà¸à¸šà¸ªà¸–à¸´à¸•à¸´à¹ƒà¸™à¹„à¸Ÿà¸¥à¹Œ XML")
      #                 return
                  
      #             # à¸™à¸±à¸šà¸ˆà¸³à¸™à¸§à¸™
      #             passed = int(stats.get('pass', '0'))
      #             failed = int(stats.get('fail', '0'))
      #             skipped = int(stats.get('skip', '0'))
      #             total = passed + failed + skipped
                  
      #             if total == 0:
      #                 print("âš ï¸ à¹„à¸¡à¹ˆà¸¡à¸µ test cases à¸–à¸¹à¸à¸£à¸±à¸™")
      #                 return
                  
      #             # à¸„à¸³à¸™à¸§à¸“à¹€à¸›à¸­à¸£à¹Œà¹€à¸‹à¹‡à¸™à¸•à¹Œ
      #             pass_rate = round((passed / total * 100), 1)
      #             fail_rate = round((failed / total * 100), 1)
                  
      #             # à¹€à¸à¹‡à¸šà¸£à¸²à¸¢à¸Šà¸·à¹ˆà¸­ Test
      #             passed_tests = []
      #             failed_tests = []
      #             failed_errors = {}
                  
      #             for test in root.findall('.//test'):
      #                 test_name = test.get('name', 'Unknown')
      #                 test_status = test.get('status', 'UNKNOWN')
                      
      #                 if test_status == 'PASS':
      #                     passed_tests.append(test_name)
      #                 elif test_status == 'FAIL':
      #                     failed_tests.append(test_name)
      #                     # à¸«à¸² error message
      #                     msg = test.find('.//msg[@level="FAIL"]')
      #                     if msg is not None and msg.text:
      #                         error = msg.text.split('\n')[0][:100]
      #                         failed_errors[test_name] = error
                  
      #             # à¹à¸ªà¸”à¸‡à¸œà¸¥à¹ƒà¸™ Console
      #             print("\n" + "="*60)
      #             print("ğŸ“Š TEST EXECUTION SUMMARY")
      #             print("="*60)
      #             print(f"âœ… Passed:  {passed:3d} tests ({pass_rate}%)")
      #             print(f"âŒ Failed:  {failed:3d} tests ({fail_rate}%)")
      #             if skipped > 0:
      #                 print(f"â­ï¸ Skipped: {skipped:3d} tests")
      #             print("-"*60)
      #             print(f"ğŸ“Š Total:   {total:3d} tests")
      #             print(f"ğŸ“ˆ Pass Rate: {pass_rate}%")
      #             print("="*60)
                  
      #             # à¸ªà¸£à¹‰à¸²à¸‡ GitHub Summary
      #             summary_file = os.environ.get('GITHUB_STEP_SUMMARY')
      #             if summary_file:
      #                 with open(summary_file, 'w') as f:
      #                     # === HEADER ===
      #                     if pass_rate == 100:
      #                         f.write("# âœ… All Tests Passed!\n\n")
      #                     elif pass_rate >= 80:
      #                         f.write("# âœ… Web Test Results\n\n")
      #                     elif pass_rate >= 60:
      #                         f.write("# âš ï¸ Web Test Results\n\n")
      #                     else:
      #                         f.write("# âŒ Web Test Results\n\n")
                          
      #                     # === SUMMARY TABLE ===
      #                     f.write("## ğŸ“Š Test Summary\n\n")
      #                     f.write("| Metric | Value | Percentage |\n")
      #                     f.write("|:-------|------:|:----------:|\n")
      #                     f.write(f"| âœ… **Passed** | **{passed}** | **{pass_rate}%** |\n")
      #                     f.write(f"| âŒ **Failed** | **{failed}** | **{fail_rate}%** |\n")
      #                     if skipped > 0:
      #                         skip_rate = round((skipped / total * 100), 1)
      #                         f.write(f"| â­ï¸ **Skipped** | **{skipped}** | **{skip_rate}%** |\n")
      #                     f.write(f"| ğŸ“Š **Total** | **{total}** | **100%** |\n")
      #                     f.write("\n")
                          
      #                     # === BADGES ===
      #                     color = 'brightgreen' if pass_rate >= 80 else 'yellow' if pass_rate >= 60 else 'red'
      #                     f.write(f"![Tests](https://img.shields.io/badge/Tests-{passed}%20passed%2C%20{failed}%20failed-{color})\n")
      #                     f.write(f"![Pass Rate](https://img.shields.io/badge/Pass%20Rate-{pass_rate}%25-{color})\n")
      #                     f.write("\n---\n\n")
                          
      #                     # === PASSED TESTS ===
      #                     if passed_tests:
      #                         f.write("## âœ… Passed Tests\n\n")
      #                         if len(passed_tests) > 5:
      #                             # à¸–à¹‰à¸²à¸¡à¸µà¹€à¸¢à¸­à¸° à¹ƒà¸Šà¹‰ collapsible
      #                             f.write("<details>\n")
      #                             f.write(f"<summary><b>View all {len(passed_tests)} passed tests</b></summary>\n\n")
      #                             for test in passed_tests:
      #                                 f.write(f"- âœ… {test}\n")
      #                             f.write("\n</details>\n\n")
      #                         else:
      #                             # à¸–à¹‰à¸²à¸™à¹‰à¸­à¸¢ à¹à¸ªà¸”à¸‡à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”
      #                             for test in passed_tests:
      #                                 f.write(f"- âœ… {test}\n")
      #                             f.write("\n")
                          
      #                     # === FAILED TESTS ===
      #                     if failed_tests:
      #                         f.write("## âŒ Failed Tests\n\n")
      #                         f.write("| Test Name | Error Message |\n")
      #                         f.write("|:----------|:--------------|")
      #                         for test in failed_tests:
      #                             error = failed_errors.get(test, "No error message")
      #                             # Escape special characters
      #                             error = error.replace('|', '\\|').replace('\n', ' ')
      #                             f.write(f"\n| **{test}** | `{error}` |")
      #                         f.write("\n\n")
                          
      #                     # === STATISTICS ===
      #                     f.write("## ğŸ“ˆ Test Statistics\n\n")
      #                     f.write("```\n")
      #                     f.write(f"Total Test Cases : {total}\n")
      #                     f.write(f"â”œâ”€â”€ âœ… Passed    : {passed} ({pass_rate}%)\n")
      #                     f.write(f"â”œâ”€â”€ âŒ Failed    : {failed} ({fail_rate}%)\n")
      #                     if skipped > 0:
      #                         skip_rate = round((skipped / total * 100), 1)
      #                         f.write(f"â”œâ”€â”€ â­ï¸ Skipped   : {skipped} ({skip_rate}%)\n")
      #                     f.write(f"â””â”€â”€ ğŸ“Š Pass Rate : {pass_rate}%\n")
      #                     f.write("```\n\n")
                          
      #                     # === EXECUTION INFO ===
      #                     f.write("## â„¹ï¸ Execution Information\n\n")
      #                     f.write("| Property | Value |\n")
      #                     f.write("|:---------|:------|")
      #                     f.write(f"\n| **Status** | {'ğŸŸ¢ Success' if failed == 0 else 'ğŸŸ¡ Unstable' if failed <= 2 else 'ğŸ”´ Failed'} |")
      #                     f.write(f"\n| **Browser** | Chrome (Headless) |")
      #                     f.write(f"\n| **Test Suite** | Web Tests |")
      #                     f.write(f"\n| **Environment** | Ubuntu Latest |")
      #                     f.write("\n\n")
                          
      #                     # === FOOTER ===
      #                     f.write("---\n")
      #                     f.write("*Generated by GitHub Actions CI/CD Pipeline*\n")
                      
      #                 print("\nâœ… GitHub Summary created successfully!")
                  
      #         except Exception as e:
      #             print(f"âŒ Error: {str(e)}")
      #             # à¸ªà¸£à¹‰à¸²à¸‡ Error Summary
      #             summary_file = os.environ.get('GITHUB_STEP_SUMMARY')
      #             if summary_file:
      #                 with open(summary_file, 'w') as f:
      #                     f.write("# âŒ Error Processing Test Results\n\n")
      #                     f.write("```\n")
      #                     f.write(str(e))
      #                     f.write("\n```\n")
          
      #     if __name__ == "__main__":
      #         create_summary()
      #     PYTHON_EOF
      
      # # ============================================
      # # STEP 4: Upload Artifacts
      # # ============================================
      # - name: ğŸ“ Upload Test Results
      #   if: always()
      #   uses: actions/upload-artifact@v4
      #   with:
      #     name: test-results-${{ github.run_number }}
      #     path: results/
      #     retention-days: 30
        
        
      
      
      

      # - name: ğŸ“Š Generate Test Summary Report
      #   if: always()
      #   run: |
      #     # à¸ªà¸£à¹‰à¸²à¸‡ Python script à¸ªà¸³à¸«à¸£à¸±à¸šà¸§à¸´à¹€à¸„à¸£à¸²à¸°à¸«à¹Œà¸œà¸¥
      #     cat > analyze_results.py << 'PYTHON_SCRIPT'
      #     import xml.etree.ElementTree as ET
      #     import os
      #     import json
          
      #     def analyze_robot_results():
      #         xml_file = 'results/output.xml'
              
      #         if not os.path.exists(xml_file):
      #             print("âŒ à¹„à¸¡à¹ˆà¸à¸šà¹„à¸Ÿà¸¥à¹Œà¸œà¸¥à¸à¸²à¸£à¸—à¸”à¸ªà¸­à¸š")
      #             return
              
      #         try:
      #             tree = ET.parse(xml_file)
      #             root = tree.getroot()
                  
      #             # à¸”à¸¶à¸‡à¸ªà¸–à¸´à¸•à¸´à¸«à¸¥à¸±à¸
      #             stats = root.find('.//statistics/total/stat')
      #             if stats is None:
      #                 print("âŒ à¹„à¸¡à¹ˆà¸à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸–à¸´à¸•à¸´à¹ƒà¸™à¹„à¸Ÿà¸¥à¹Œ")
      #                 return
                  
      #             # à¸™à¸±à¸šà¸ˆà¸³à¸™à¸§à¸™ Pass/Fail/Skip
      #             passed = int(stats.get('pass', 0))
      #             failed = int(stats.get('fail', 0))
      #             skipped = int(stats.get('skip', 0))
      #             total = passed + failed + skipped
                  
      #             # à¸„à¸³à¸™à¸§à¸“à¹€à¸›à¸­à¸£à¹Œà¹€à¸‹à¹‡à¸™à¸•à¹Œ
      #             pass_percentage = (passed / total * 100) if total > 0 else 0
      #             fail_percentage = (failed / total * 100) if total > 0 else 0
                  
      #             # à¹à¸ªà¸”à¸‡à¸œà¸¥à¹ƒà¸™ Console
      #             print("\n" + "="*60)
      #             print("ğŸ“Š WEB TEST EXECUTION SUMMARY")
      #             print("="*60)
      #             print(f"âœ… PASSED:  {passed:3d} tests ({pass_percentage:6.2f}%)")
      #             print(f"âŒ FAILED:  {failed:3d} tests ({fail_percentage:6.2f}%)")
      #             if skipped > 0:
      #                 skip_percentage = (skipped / total * 100)
      #                 print(f"â­ï¸  SKIPPED: {skipped:3d} tests ({skip_percentage:6.2f}%)")
      #             print("-"*60)
      #             print(f"ğŸ“Š TOTAL:   {total:3d} tests (100.00%)")
      #             print(f"ğŸ“ˆ PASS RATE: {pass_percentage:.2f}%")
      #             print("="*60)
                  
      #             # à¹€à¸à¹‡à¸šà¸£à¸²à¸¢à¸Šà¸·à¹ˆà¸­ Test
      #             passed_tests = []
      #             failed_tests = []
      #             failed_details = []
                  
      #             for test in root.findall('.//test'):
      #                 test_name = test.get('name', 'Unknown')
      #                 test_status = test.get('status', 'UNKNOWN')
                      
      #                 if test_status == 'PASS':
      #                     passed_tests.append(test_name)
      #                 elif test_status == 'FAIL':
      #                     failed_tests.append(test_name)
      #                     # à¸«à¸² error message
      #                     msg = test.find('.//msg[@level="FAIL"]')
      #                     error_msg = msg.text if msg is not None and msg.text else "No error message"
      #                     # à¸•à¸±à¸” error message à¹ƒà¸«à¹‰à¸ªà¸±à¹‰à¸™à¸¥à¸‡
      #                     error_msg = error_msg.split('\n')[0][:80]
      #                     failed_details.append({'name': test_name, 'error': error_msg})
                  
      #             # à¸ªà¸£à¹‰à¸²à¸‡ Markdown à¸ªà¸³à¸«à¸£à¸±à¸š GitHub Summary
      #             with open('test_summary.md', 'w') as f:
      #                 # Header with emoji based on status
      #                 if pass_percentage == 100:
      #                     f.write("# âœ… Web Test Results - All Passed!\n\n")
      #                 elif pass_percentage >= 80:
      #                     f.write("# âœ… Web Test Results\n\n")
      #                 elif pass_percentage >= 60:
      #                     f.write("# âš ï¸ Web Test Results\n\n")
      #                 else:
      #                     f.write("# âŒ Web Test Results\n\n")
                      
      #                 # à¸•à¸²à¸£à¸²à¸‡à¸ªà¸£à¸¸à¸›
      #                 f.write("## ğŸ“Š Summary\n\n")
      #                 f.write("| Status | Count | Percentage |\n")
      #                 f.write("|--------|-------|------------|\n")
      #                 f.write(f"| âœ… **Passed** | **{passed}** | **{pass_percentage:.2f}%** |\n")
      #                 f.write(f"| âŒ **Failed** | **{failed}** | **{fail_percentage:.2f}%** |\n")
                      
      #                 if skipped > 0:
      #                     skip_percentage = (skipped / total * 100)
      #                     f.write(f"| â­ï¸ **Skipped** | **{skipped}** | **{skip_percentage:.2f}%** |\n")
                      
      #                 f.write(f"| ğŸ“Š **Total** | **{total}** | **100.00%** |\n\n")
                      
      #                 # Badges
      #                 color = 'brightgreen' if pass_percentage >= 80 else 'yellow' if pass_percentage >= 60 else 'red'
      #                 f.write(f"![Tests](https://img.shields.io/badge/Tests-{passed}%20passed%2C%20{failed}%20failed-{color})\n")
      #                 f.write(f"![Pass Rate](https://img.shields.io/badge/Pass%20Rate-{pass_percentage:.1f}%25-{color})\n\n")
                      
      #                 # à¸£à¸²à¸¢à¸Šà¸·à¹ˆà¸­ Test Cases à¸—à¸µà¹ˆ Pass
      #                 if passed_tests:
      #                     f.write("## âœ… Passed Tests\n\n")
      #                     f.write("<details>\n")
      #                     f.write(f"<summary>Click to view {len(passed_tests)} passed tests</summary>\n\n")
      #                     for test in passed_tests:
      #                         f.write(f"- âœ… {test}\n")
      #                     f.write("\n</details>\n\n")
                      
      #                 # à¸£à¸²à¸¢à¸Šà¸·à¹ˆà¸­ Test Cases à¸—à¸µà¹ˆ Fail
      #                 if failed_tests:
      #                     f.write("## âŒ Failed Tests\n\n")
      #                     f.write("| Test Name | Error Message |\n")
      #                     f.write("|-----------|---------------|\n")
      #                     for detail in failed_details:
      #                         # à¸—à¸³à¹ƒà¸«à¹‰ error message à¸ªà¸±à¹‰à¸™à¸¥à¸‡à¹à¸¥à¸°à¸­à¹ˆà¸²à¸™à¸‡à¹ˆà¸²à¸¢
      #                         error = detail['error'].replace('|', '\\|')
      #                         f.write(f"| âŒ **{detail['name']}** | `{error}` |\n")
      #                     f.write("\n")
                      
      #                 # Test Details Section
      #                 f.write("## ğŸ“‹ Test Details\n\n")
      #                 f.write("### Test Distribution\n")
      #                 f.write("```\n")
      #                 f.write(f"Total Tests: {total}\n")
      #                 f.write(f"â”œâ”€â”€ âœ… Passed: {passed} ({pass_percentage:.1f}%)\n")
      #                 f.write(f"â”œâ”€â”€ âŒ Failed: {failed} ({fail_percentage:.1f}%)\n")
      #                 if skipped > 0:
      #                     f.write(f"â””â”€â”€ â­ï¸ Skipped: {skipped} ({(skipped/total*100):.1f}%)\n")
      #                 else:
      #                     f.write(f"â””â”€â”€ â­ï¸ Skipped: 0 (0.0%)\n")
      #                 f.write("```\n\n")
                      
      #                 # Quick Summary Box
      #                 f.write("### ğŸ“ˆ Quick Stats\n")
      #                 f.write("```yaml\n")
      #                 f.write(f"Pass Rate: {pass_percentage:.2f}%\n")
      #                 f.write(f"Total Execution: {total} tests\n")
      #                 f.write(f"Status: {'âœ… Success' if failed == 0 else 'âš ï¸ Unstable' if failed <= 2 else 'âŒ Failed'}\n")
      #                 f.write("```\n")
                  
      #             # à¹à¸ªà¸”à¸‡à¸£à¸²à¸¢à¸Šà¸·à¹ˆà¸­ test à¹ƒà¸™ console
      #             if passed_tests:
      #                 print(f"\nâœ… PASSED TESTS ({len(passed_tests)}):")
      #                 print("-" * 40)
      #                 for test in passed_tests[:5]:  # à¹à¸ªà¸”à¸‡à¹à¸„à¹ˆ 5 à¸­à¸±à¸™à¹à¸£à¸
      #                     print(f"  âœ“ {test}")
      #                 if len(passed_tests) > 5:
      #                     print(f"  ... and {len(passed_tests)-5} more")
                  
      #             if failed_tests:
      #                 print(f"\nâŒ FAILED TESTS ({len(failed_tests)}):")
      #                 print("-" * 40)
      #                 for detail in failed_details:
      #                     print(f"  âœ— {detail['name']}")
      #                     print(f"    Error: {detail['error'][:60]}...")
                  
      #             print("\nâœ… Summary report created successfully!")
                  
      #         except Exception as e:
      #             print(f"âŒ Error analyzing results: {str(e)}")
          
      #     if __name__ == "__main__":
      #         analyze_robot_results()
      #     PYTHON_SCRIPT
          
      #     # à¸£à¸±à¸™ script à¸§à¸´à¹€à¸„à¸£à¸²à¸°à¸«à¹Œà¸œà¸¥
      #     python analyze_results.py